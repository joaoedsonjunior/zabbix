Update Zabbix 4 para Zabbix 5

PROCEDIMENTO DE ATUALIZAÇÃO

1 PARE OS PROCESSOS DO ZABBIX
Pare o servidor Zabbix para certificar-se de que nenhum novo dado seja inserido no banco de dados.

systemctl stop zabbix-server
Se estiver atualizando o proxy, pare o proxy também.

2 FAÇA BACKUP DO BANCO DE DADOS ZABBIX EXISTENTE
Este é um passo muito importante. Certifique-se de ter um backup do seu banco de dados. Isso ajudará se o procedimento de atualização falhar (falta de espaço em disco, desligamento, qualquer problema inesperado).

3 FAÇA BACKUP DE ARQUIVOS DE CONFIGURAÇÃO, ARQUIVOS PHP E BINÁRIOS ZABBIX
Faça uma cópia de backup dos binários do Zabbix, arquivos de configuração e diretório de arquivos PHP.

Arquivos de configuração:
mkdir /opt/zabbix-backup/
cp /etc/zabbix/zabbix_server.conf / opt / zabbix-backup /
cp /etc/httpd/conf.d/zabbix.conf / opt / zabbix-backup /

Arquivos PHP e binários Zabbix:
cp -R / usr / share / zabbix / / opt / zabbix-backup /
cp -R / usr / share / doc / zabbix- * / opt / zabbix-backup /

4 ATUALIZAR PACOTE DE CONFIGURAÇÃO DO REPOSITÓRIO
Para prosseguir com a atualização, seu pacote de repositório atual deve ser atualizado.


RHEL / CentOS 8
# rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/8/x86_64/zabbix-release-5.0-1.el8.noarch.rpm

RHEL / CentOS 7
# rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm


5 ATUALIZAR COMPONENTES DO ZABBIX

Para atualizar os componentes do Zabbix, você pode executar algo como:
yum upgrade zabbix-server-mysql zabbix-web-mysql zabbix-agent
Se estiver usando PostgreSQL, substitua mysqlpor pgsqlno comando. Se estiver atualizando o proxy, substitua serverpor proxyno comando. Se estiver fazendo upgrade do agente 2, substitua zabbix-agentpor zabbix-agent2no comando.

Para atualizar o front-end da web com Apache no RHEL 8 corretamente, execute também:

# yum install zabbix-apache-conf 
e faça as alterações necessárias neste arquivo.

Para atualizar o front - end da web no RHEL 7, siga as instruções nesta página (etapas extras são necessárias para instalar o PHP 7.2 ou mais recente).
Em particular, certifique-se de instalar o zabbix-apache-conf-sclpacote se você usar o servidor web Apache.

 # yum install zabbix-apache-conf-scl
6 REVISE OS PARÂMETROS DE CONFIGURAÇÃO DO COMPONENTE
Consulte as notas de atualização para obter detalhes sobre as alterações obrigatórias .

7 INICIE OS PROCESSOS DO ZABBIX
Inicie os componentes atualizados do Zabbix.

# systemctl start zabbix-server
# systemctl start zabbix-proxy

8 LIMPE OS COOKIES E O CACHE DO NAVEGADOR DA WEB
Após a atualização, pode ser necessário limpar os cookies e o cache do navegador da web para que a interface da web do Zabbix funcione corretamente.

Problemas Recorrentes:
Quando o Banco de dados é postgres e der o erro: 
ERROR:  canceling statement due to statement timeout

Executar logado no postgres
set statement_timeout = 0;

